# nanobot äº§å“æ¶æ„è¯´æ˜æ–‡æ¡£

## 1. ä¸šåŠ¡æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯ nanobot

nanobot æ˜¯ä¸€ä¸ª**è¶…è½»é‡çº§çš„ä¸ªäºº AI åŠ©æ‰‹**ï¼Œå®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ç”¨æœ€å°‘çš„ä»£ç ï¼ˆçº¦ 4000 è¡Œï¼‰å®ç°å®Œæ•´çš„ AI Agent åŠŸèƒ½ã€‚ç›¸æ¯”äºå…¶ä»–å¤æ‚çš„ AI æ¡†æ¶ï¼ˆå¦‚ Clawdbot çš„ 43 ä¸‡è¡Œä»£ç ï¼‰ï¼Œnanobot ä»…æœ‰å…¶ 1% çš„å¤§å°ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º "nano"ï¼ˆçº³ç±³ï¼‰çº§åˆ«çš„æœºå™¨äººã€‚

### 1.2 äº§å“å®šä½

- **ä¸ªäºº AI åŠ©æ‰‹**ï¼šå¸®åŠ©ç”¨æˆ·å®Œæˆå„ç§ä»»åŠ¡ï¼Œå¦‚å›ç­”é—®é¢˜ã€æ‰§è¡Œå‘½ä»¤ã€æœç´¢ä¿¡æ¯ç­‰
- **å¤šé€šé“æ¥å…¥**ï¼šæ”¯æŒé€šè¿‡é£ä¹¦ã€å‘½ä»¤è¡Œç­‰å¤šç§æ¸ é“ä¸ç”¨æˆ·äº¤äº’
- **å¯æ‰©å±•å·¥å…·**ï¼šå†…ç½®å¤šç§å·¥å…·ï¼ˆShellã€æ–‡ä»¶æ“ä½œã€ç½‘é¡µæœç´¢ç­‰ï¼‰ï¼ŒåŒæ—¶æ”¯æŒ MCP æ‰©å±•

### 1.3 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| ğŸª¶ è¶…è½»é‡ | ä»…çº¦ 4000 è¡Œä»£ç ï¼Œå¯åŠ¨å¿«ã€èµ„æºå ç”¨ä½ |
| ğŸ”§ æ˜“æ‰©å±• | åŸºäº TypeScriptï¼Œä»£ç æ¸…æ™°æ˜“è¯» |
| âš¡ é—ªç”µé€Ÿåº¦ | ä½¿ç”¨ Bun è¿è¡Œæ—¶ï¼Œæ€§èƒ½ä¼˜å¼‚ |
| ğŸ› ï¸ å·¥å…·ä¸°å¯Œ | Shellã€ç½‘é¡µã€æ–‡ä»¶ã€å­è¿›ç¨‹ç®¡ç†ç­‰ |
| ğŸ“± å¤šé€šé“ | æ”¯æŒé£ä¹¦é›†æˆ |
| â° å®šæ—¶ä»»åŠ¡ | å†…ç½® Cron ä»»åŠ¡è°ƒåº¦ |
| ğŸ’“ å¿ƒè·³æœåŠ¡ | å®šæ—¶ä¸»åŠ¨å”¤é†’æ‰§è¡Œä»»åŠ¡ |

---

## 2. ç³»ç»Ÿæ¶æ„å›¾

### 2.1 æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph ç”¨æˆ·å±‚
        CLI[å‘½ä»¤è¡Œ CLI]
        Gateway[ç½‘å…³æœåŠ¡]
        Feishu[é£ä¹¦æ¶ˆæ¯]
    end
    
    subgraph æ ¸å¿ƒå±‚
        AgentLoop[Agent å¾ªç¯å¼•æ“]
        ContextBuilder[ä¸Šä¸‹æ–‡æ„å»ºå™¨]
        SkillsLoader[æŠ€èƒ½åŠ è½½å™¨]
        SessionManager[ä¼šè¯ç®¡ç†å™¨]
    end
    
    subgraph LLM å±‚
        Anthropic[Anthropic (Claude)]
        OpenAI[OpenAI (GPT)]
    end
    
    subgraph å·¥å…·å±‚
        Shell[Shell å·¥å…·]
        Web[ç½‘é¡µå·¥å…·]
        FileSystem[æ–‡ä»¶ç³»ç»Ÿå·¥å…·]
        Spawn[å­è¿›ç¨‹å·¥å…·]
        Message[æ¶ˆæ¯å·¥å…·]
    end
    
    subgraph æœåŠ¡å±‚
        Cron[å®šæ—¶ä»»åŠ¡æœåŠ¡]
        Heartbeat[å¿ƒè·³æœåŠ¡]
        Bus[æ¶ˆæ¯æ€»çº¿]
        ChannelManager[é€šé“ç®¡ç†å™¨]
    end
    
    CLI --> AgentLoop
    Gateway --> ChannelManager
    Feishu --> ChannelManager
    ChannelManager --> Bus
    Bus --> AgentLoop
    
    AgentLoop --> ContextBuilder
    AgentLoop --> SkillsLoader
    AgentLoop --> SessionManager
    AgentLoop --> Anthropic
    AgentLoop --> OpenAI
    
    AgentLoop --> Shell
    AgentLoop --> Web
    AgentLoop --> FileSystem
    AgentLoop --> Spawn
    AgentLoop --> Message
    
    Cron --> AgentLoop
    Heartbeat --> AgentLoop
```

### 2.2 æ•°æ®æµå‘å›¾

```mermaid
sequenceDiagram
    participant ç”¨æˆ· as ç”¨æˆ·
    participant CLI as å‘½ä»¤è¡Œ
    participant ç½‘å…³ as ç½‘å…³æœåŠ¡
    participant é£ä¹¦ as é£ä¹¦
    participant é€šé“ç®¡ç† as é€šé“ç®¡ç†å™¨
    participant æ€»çº¿ as æ¶ˆæ¯æ€»çº¿
    participant ä¼šè¯ as ä¼šè¯ç®¡ç†
    participant Agent as Agentå¾ªç¯
    participant LLM as LLMæä¾›å•†
    participant å·¥å…· as å·¥å…·é›†
    participant æ–‡ä»¶ as æ–‡ä»¶ç³»ç»Ÿ

    Note over ç”¨æˆ·,LLM: è·¯å¾„1: å‘½ä»¤è¡Œç›´æ¥äº¤äº’
    ç”¨æˆ·->>CLI: è¾“å…¥æ¶ˆæ¯
    CLI->>Agent: processDirect()
    
    Note over ç”¨æˆ·,LLM: è·¯å¾„2: ç½‘å…³æœåŠ¡äº¤äº’
    ç”¨æˆ·->>é£ä¹¦: å‘é€æ¶ˆæ¯
    é£ä¹¦->>é€šé“ç®¡ç†: æ¥æ”¶æ¶ˆæ¯
    é€šé“ç®¡ç†->>æ€»çº¿: publishInbound()
    æ€»çº¿->>Agent: consumeInbound()
    
    Note over Agent,LLM: Agent å¾ªç¯æ ¸å¿ƒæµç¨‹
    Agent->>ä¼šè¯: è·å–/åˆ›å»ºä¼šè¯
    Agent->>LLM: å‘é€æ¶ˆæ¯
    LLM-->>Agent: è¿”å›å“åº”(å«å·¥å…·è°ƒç”¨)
    
    loop å·¥å…·æ‰§è¡Œå¾ªç¯
        Agent->>å·¥å…·: æ‰§è¡Œå·¥å…·
        å·¥å…·-->>Agent: è¿”å›ç»“æœ
        Agent->>LLM: å‘é€å·¥å…·ç»“æœ
        LLM-->>Agent: è¿”å›æœ€ç»ˆå“åº”
    end
    
    Agent->>ä¼šè¯: ä¿å­˜å¯¹è¯å†å²
    Agent->>æ€»çº¿: publishOutbound()
    æ€»çº¿->>é€šé“ç®¡ç†: è½¬å‘å“åº”
    é€šé“ç®¡ç†-->>é£ä¹¦: å‘é€æ¶ˆæ¯
    é£ä¹¦-->>ç”¨æˆ·: æ˜¾ç¤ºå“åº”
```

---

## 3. æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 3.1 Agent å¾ªç¯ (Agent Loop)

**æ¨¡å—èŒè´£**ï¼šè¿™æ˜¯ nanobot çš„"å¿ƒè„"ï¼Œè´Ÿè´£åè°ƒ LLM å’Œå·¥å…·ä¹‹é—´çš„äº¤äº’ã€‚

**å·¥ä½œæµç¨‹**ï¼ˆç”¨é€šä¿—çš„è¯æ¥è¯´ï¼‰ï¼š

```mermaid
flowchart TD
    A[ç”¨æˆ·å‘é€æ¶ˆæ¯] --> B[è·å–æˆ–åˆ›å»ºä¼šè¯]
    B --> C[æ„å»ºç³»ç»Ÿæç¤ºè¯]
    C --> D[æ„å»ºå¯¹è¯æ¶ˆæ¯å†å²]
    D --> E{å¾ªç¯: æœ€å¤šNæ¬¡}
    E -->|æ˜¯| F[è°ƒç”¨ LLM]
    F --> G{LLM è¿”å›å·¥å…·è°ƒç”¨?}
    G -->|æ˜¯| H[æ‰§è¡Œå·¥å…·]
    H --> I[å°†å·¥å…·ç»“æœå‘å› LLM]
    I --> E
    G -->|å¦| J[è¿”å›æœ€ç»ˆå›å¤]
    E -->|å¦| J
    J --> K[ä¿å­˜ä¼šè¯å†å²]
    K --> L[è¿”å›å›å¤ç»™ç”¨æˆ·]
```

**å…³é”®ä»£ç é€»è¾‘** (`src/agent/loop.ts`)ï¼š

```typescript
// ä¼ªä»£ç å±•ç¤ºæ ¸å¿ƒå¾ªç¯
async processDirect(content: string, sessionKey: string): Promise<string> {
    // 1. è·å–ä¼šè¯
    const session = this.sessions.getOrCreate(sessionKey);
    
    // 2. æ„å»ºæ¶ˆæ¯ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæç¤º + å†å² + å½“å‰è¾“å…¥ï¼‰
    const messages = [
        { role: "system", content: this.context.buildSystemPrompt() },
        ...session.getHistory(),
        { role: "user", content }
    ];
    
    // 3. å¾ªç¯è°ƒç”¨ LLM å’Œå·¥å…·
    while (iteration < maxIterations) {
        // è°ƒç”¨ LLM
        const response = await this.provider.chat({
            messages,
            tools: this.tools.get_definitions()
        });
        
        // å¦‚æœ LLM è¿”å›äº†å·¥å…·è°ƒç”¨
        if (response.toolCalls) {
            // æ‰§è¡Œæ¯ä¸ªå·¥å…·
            for (const toolCall of response.toolCalls) {
                const result = await this.tools.execute(
                    toolCall.name,
                    toolCall.arguments
                );
                // å°†å·¥å…·ç»“æœåŠ å…¥æ¶ˆæ¯
                messages.push({
                    role: "tool",
                    content: result,
                    toolCallId: toolCall.id
                });
            }
        } else {
            // LLM è¿”å›æœ€ç»ˆå›å¤ï¼Œé€€å‡ºå¾ªç¯
            finalContent = response.content;
            break;
        }
    }
    
    // 4. ä¿å­˜ä¼šè¯
    session.addMessage("user", content);
    session.addMessage("assistant", finalContent);
    this.sessions.save(session);
    
    return finalContent;
}
```

### 3.2 ä¸Šä¸‹æ–‡æ„å»ºå™¨ (Context Builder)

**æ¨¡å—èŒè´£**ï¼šè´Ÿè´£æ„å»ºå‘é€ç»™ LLM çš„ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰ï¼ŒåŒ…æ‹¬ï¼š

- Agent æŒ‡ä»¤ (AGENTS.md)
- äººæ ¼è®¾å®š (SOUL.md)
- ç”¨æˆ·ä¿¡æ¯ (USER.md)
- å¯ç”¨æŠ€èƒ½åˆ—è¡¨ (Skills)

**é€šä¿—ç†è§£**ï¼šå°±åƒä½ åœ¨ä¸äººå¯¹è¯å‰ï¼Œä¼šå…ˆç»™ä»–ä¸€ä»½"å·¥ä½œæ‰‹å†Œ"ï¼Œå‘Šè¯‰ä»–åº”è¯¥æ€ä¹ˆåšã€æœ‰ä»€ä¹ˆèµ„æºå¯ç”¨ã€‚Context Builder å°±æ˜¯åˆ¶ä½œè¿™ä»½æ‰‹å†Œçš„"ç§˜ä¹¦"ã€‚

### 3.3 æŠ€èƒ½åŠ è½½å™¨ (Skills Loader)

**æ¨¡å—èŒè´£**ï¼šåŠ¨æ€åŠ è½½å’Œç®¡ç†"æŠ€èƒ½åŒ…"ï¼ˆSkillsï¼‰ã€‚

**æŠ€èƒ½æ˜¯ä»€ä¹ˆ**ï¼šSkill æ˜¯é¢„å…ˆå°è£…å¥½çš„å·¥å…·é›†åˆï¼Œæ¯”å¦‚ï¼š
- `github` æŠ€èƒ½ï¼šå¸®ä½ æ“ä½œ GitHub
- `tmux` æŠ€èƒ½ï¼šå¸®ä½ ç®¡ç†ç»ˆç«¯ä¼šè¯
- `skill-manager` æŠ€èƒ½ï¼šç®¡ç†å…¶ä»–æŠ€èƒ½

**åŠ è½½æ–¹å¼**ï¼š
- **always-skills**ï¼šæ¯æ¬¡éƒ½è‡ªåŠ¨åŠ è½½
- **æŒ‰éœ€åŠ è½½**ï¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚åŠ¨æ€åŠ è½½

### 3.4 ä¼šè¯ç®¡ç† (Session Manager)

**æ¨¡å—èŒè´£**ï¼šç®¡ç†å¯¹è¯å†å²ï¼Œè®© Agent èƒ½"è®°ä½"ä¹‹å‰çš„å¯¹è¯å†…å®¹ã€‚

**é€šä¿—ç†è§£**ï¼šå°±åƒå¾®ä¿¡çš„èŠå¤©è®°å½•ï¼Œä¼šè¯ç®¡ç†è´Ÿè´£ï¼š
- åˆ›å»ºæ–°ä¼šè¯
- ä¿å­˜å¯¹è¯å†å²åˆ°æ–‡ä»¶
- è¯»å–å†å²å¯¹è¯
- ä¼šè¯è¿‡æœŸç®¡ç†

**å­˜å‚¨æ ¼å¼**ï¼šä½¿ç”¨ JSONLï¼ˆJSON Linesï¼‰æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼š

```json
{"_type":"metadata","created_at":"2026-01-01T00:00:00.000Z","updated_at":"2026-01-01T00:00:00.000Z","metadata":{}}
{"role":"user","content":"ä½ å¥½"}
{"role":"assistant","content":"ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}
{"role":"user","content":"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"}
{"role":"assistant","content":"è®©æˆ‘æŸ¥ä¸€ä¸‹...ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œ25åº¦"}
```

---

## 4. é€šé“ä¸æ¶ˆæ¯è·¯ç”±

### 4.1 æ¶ˆæ¯æ€»çº¿ (Message Bus)

**æ¨¡å—èŒè´£**ï¼šè´Ÿè´£åœ¨ä¸åŒç»„ä»¶ä¹‹é—´ä¼ é€’æ¶ˆæ¯ï¼Œæ˜¯ç³»ç»Ÿçš„"äº¤é€šæ¢çº½"ã€‚

```mermaid
flowchart LR
    subgraph è¾“å…¥
        Inbound[å…¥ç«™æ¶ˆæ¯]
    end
    
    subgraph æ€»çº¿
        Bus((æ¶ˆæ¯æ€»çº¿))
    end
    
    subgraph è¾“å‡º
        Outbound[å‡ºç«™æ¶ˆæ¯]
    end
    
    Inbound -->|publishInbound| Bus
    Bus -->|consumeInbound| Agent
    Agent -->|publishOutbound| Bus
    Bus -->|consumeOutbound| Channel
    Channel --> Outbound
```

**ä¸¤ç§æ¶ˆæ¯ç±»å‹**ï¼š
1. **å…¥ç«™æ¶ˆæ¯ (Inbound)**ï¼šä»ç”¨æˆ·åˆ° Agent
2. **å‡ºç«™æ¶ˆæ¯ (Outbound)**ï¼šä» Agent åˆ°ç”¨æˆ·

### 4.2 é€šé“ç®¡ç†å™¨ (Channel Manager)

**æ¨¡å—èŒè´£**ï¼šç®¡ç†å„ç§æ¶ˆæ¯é€šé“ï¼ˆç›®å‰ä¸»è¦æ˜¯é£ä¹¦ï¼‰ï¼Œè´Ÿè´£ï¼š
- å¯åŠ¨/åœæ­¢é€šé“
- æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯
- å‘é€å›å¤ç»™ç”¨æˆ·

**æ”¯æŒçš„é€šé“**ï¼š
- **é£ä¹¦ (Feishu)**ï¼šä¼ä¸šæ²Ÿé€šå·¥å…·
- **CLI**ï¼šå‘½ä»¤è¡Œç›´æ¥äº¤äº’

```mermaid
flowchart TD
    A[ç”¨æˆ·é€šè¿‡é£ä¹¦å‘é€æ¶ˆæ¯] --> B[é£ä¹¦é€šé“æ¥æ”¶]
    B --> C[è½¬æ¢ä¸ºæ ‡å‡†æ¶ˆæ¯æ ¼å¼]
    C --> D[å‘å¸ƒåˆ°æ¶ˆæ¯æ€»çº¿]
    D --> E[Agent å¤„ç†æ¶ˆæ¯]
    E --> F[ç”Ÿæˆå›å¤]
    F --> G[å‘å¸ƒåˆ°å‡ºç«™é˜Ÿåˆ—]
    H[é€šé“ç®¡ç†å™¨æ¶ˆè´¹å‡ºç«™] --> I[é£ä¹¦å‘é€å›å¤]
```

### 4.3 é£ä¹¦é›†æˆ

**å·¥ä½œåŸç†**ï¼š
1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°åˆ›å»ºåº”ç”¨
2. é…ç½® Webhook æ¥æ”¶æ¶ˆæ¯
3. nanobot é€šè¿‡é£ä¹¦ API å‘é€å›å¤

**é…ç½®é¡¹**ï¼š
```json
{
  "channels": {
    "feishu": {
      "enabled": true,
      "app_id": "YOUR_APP_ID",
      "app_secret": "YOUR_APP_SECRET",
      "allowFrom": ["open_id_1", "open_id_2"]
    }
  }
}
```

---

## 5. å®šæ—¶ä»»åŠ¡ä¸å¿ƒè·³æœåŠ¡

### 5.1 å®šæ—¶ä»»åŠ¡æœåŠ¡ (Cron Service)

**æ¨¡å—èŒè´£**ï¼šæŒ‰ç…§é¢„å®šçš„æ—¶é—´è¡¨è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€‚

**ç±»ä¼¼**ï¼šæ‰‹æœºé—¹é’Ÿ åˆ°ç‚¹å°±å“

**æ”¯æŒçš„è°ƒåº¦æ–¹å¼**ï¼š

| ç±»å‹ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| `every` | æ¯å°æ—¶ | æ¯éš”å›ºå®šæ—¶é—´æ‰§è¡Œ |
| `cron` | æ¯å¤© 9:00 | ä½¿ç”¨ Cron è¡¨è¾¾å¼ |
| `at` | 2026-01-01 00:00 | åœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡ |

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# æ¯å¤©æ—©ä¸Š 9 ç‚¹å‘é€é—®å€™
nanobot cron add --name "morning" --message "æ—©å®‰!" --cron "0 9 * * *"

# æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
nanobot cron add --name "hourly-check" --message "æ£€æŸ¥çŠ¶æ€" --every 3600
```

**æ ¸å¿ƒé€»è¾‘**ï¼š
```mermaid
flowchart TD
    A[å¯åŠ¨æœåŠ¡] --> B[åŠ è½½ä»»åŠ¡åˆ—è¡¨]
    B --> C[è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´]
    C --> D[è®¾ç½®å®šæ—¶å™¨]
    D --> E{æ—¶é—´åˆ°è¾¾?}
    E -->|æ˜¯| F[æ‰§è¡Œä»»åŠ¡]
    F --> G[æ›´æ–°ä»»åŠ¡çŠ¶æ€]
    G --> C
    E -->|å¦| D
```

### 5.2 å¿ƒè·³æœåŠ¡ (Heartbeat Service)

**æ¨¡å—èŒè´£**ï¼šå®šæ—¶ä¸»åŠ¨æ£€æŸ¥å¹¶æ‰§è¡Œä»»åŠ¡ï¼Œå°±åƒ"å¿ƒè·³"ä¸€æ ·å®šæœŸè§¦å‘ã€‚

**é€šä¿—ç†è§£**ï¼šå°±åƒä½ è®¾å®šçš„"æ¯æ—¥å¾…åŠäº‹é¡¹æé†’"ï¼Œåˆ°ç‚¹å°±æ£€æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰éœ€è¦å¤„ç†çš„äº‹æƒ…ã€‚

**å·¥ä½œæµç¨‹**ï¼š
1. å®šæœŸï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰è¯»å– `HEARTBEAT.md` æ–‡ä»¶
2. å¦‚æœæ–‡ä»¶æœ‰å†…å®¹ï¼Œæ‰§è¡Œæ–‡ä»¶ä¸­çš„ä»»åŠ¡
3. å¦‚æœè¿”å› "HEARTBEAT_OK"ï¼Œè¯´æ˜ä¸éœ€è¦æ“ä½œ

**HEARTBEAT.md ç¤ºä¾‹**ï¼š
```markdown
# å¾…åŠä»»åŠ¡

- [ ] æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
- [ ] å‘é€æ—¥æŠ¥
- [ ] æ¸…ç†ä¸´æ—¶æ–‡ä»¶
```

**é…ç½®**ï¼š
- é»˜è®¤é—´éš”ï¼š30 åˆ†é’Ÿ
- å¯è‡ªå®šä¹‰é—´éš”æ—¶é—´

---

## 6. LLM æä¾›å•†

### 6.1 æ”¯æŒçš„æ¨¡å‹

| æä¾›å•† | æ¨¡å‹ç¤ºä¾‹ | è¯´æ˜ |
|--------|----------|------|
| Anthropic | Claude Sonnet 4 | é»˜è®¤æ¨è |
| OpenAI | GPT-4o | æ”¯æŒæ¨ç†åˆ†ç¦» |
| æœ¬åœ°æ¨¡å‹ | Llama 3.1 | æ”¯æŒ Anthropic å…¼å®¹ API |

### 6.2 Anthropic æä¾›å•†

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨åŸç”Ÿ Anthropic API
- æ”¯æŒ Claude æ‰€æœ‰æ¨¡å‹
- æ”¯æŒå·¥å…·è°ƒç”¨ï¼ˆTool Useï¼‰

**ä»£ç ä½ç½®**ï¼š`src/providers/anthropic.ts`

### 6.3 OpenAI æä¾›å•†

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ OpenAI API
- æ”¯æŒ GPT-4o ç³»åˆ—
- æ”¯æŒ `reasoning_split` æ¨ç†åˆ†ç¦»åŠŸèƒ½

---

## 7. å·¥å…·ç³»ç»Ÿ

### 7.1 å†…ç½®å·¥å…·

| å·¥å…·åç§° | åŠŸèƒ½ | ç¤ºä¾‹ |
|----------|------|------|
| `shell` | æ‰§è¡Œ Shell å‘½ä»¤ | `ls -la`, `git status` |
| `web` | ç½‘é¡µæœç´¢ | æœç´¢æœ€æ–°æ–°é—» |
| `filesystem` | æ–‡ä»¶æ“ä½œ | è¯»ã€å†™ã€ç¼–è¾‘æ–‡ä»¶ |
| `spawn` | å¯åŠ¨å­è¿›ç¨‹ | è¿è¡Œåå°ä»»åŠ¡ |
| `message` | å‘é€æ¶ˆæ¯ | é€šè¿‡é€šé“å‘æ¶ˆæ¯ |

### 7.2 å·¥å…·æ³¨å†Œä¸æ‰§è¡Œ

```mermaid
flowchart TD
    A[LLM è¿”å›å·¥å…·è°ƒç”¨] --> B{æŸ¥æ‰¾å·¥å…·}
    B -->|æ‰¾åˆ°| C[æ‰§è¡Œå·¥å…·]
    B -->|æœªæ‰¾åˆ°| D[è¿”å›é”™è¯¯]
    C --> E{æ‰§è¡ŒæˆåŠŸ?}
    E -->|æ˜¯| F[è¿”å›ç»“æœ]
    E -->|å¦| G[è¿”å›é”™è¯¯ä¿¡æ¯]
    F --> H[å°†ç»“æœå‘å› LLM]
    G --> H
```

### 7.3 MCP æ‰©å±•

MCP (Model Context Protocol) å…è®¸è¿æ¥å¤–éƒ¨æœåŠ¡ï¼Œæ‰©å±• nanobot çš„èƒ½åŠ›ã€‚

**é…ç½®ç¤ºä¾‹**ï¼š
```json
{
  "mcp": {
    "enabled": true,
    "servers": [
      {
        "name": "github-tools",
        "url": "http://localhost:8000"
      }
    ]
  }
}
```

---

## 8. é…ç½®ç³»ç»Ÿ

### 8.1 é…ç½®æ–‡ä»¶ä½ç½®

- ç”¨æˆ·é…ç½®ï¼š`~/.nanobot/config.json`
- å·¥ä½œç©ºé—´ï¼š`~/.nanobot/`

### 8.2 å®Œæ•´é…ç½®é¡¹

```json
{
  "agents": {
    "defaults": {
      "model": "claude-sonnet-4-20250514",
      "max_tool_iterations": 100
    }
  },
  "providers": {
    "anthropic": {
      "apiKey": "sk-ant-xxx",
      "apiBase": "https://api.anthropic.com"
    },
    "openai": {
      "apiKey": "sk-proj-xxx"
    }
  },
  "channels": {
    "feishu": {
      "enabled": true,
      "app_id": "xxx",
      "app_secret": "xxx"
    }
  },
  "cron": {
    "enabled": true
  },
  "heartbeat": {
    "enabled": true,
    "intervalSeconds": 1800
  }
}
```

### 8.3 å·¥ä½œç©ºé—´æ–‡ä»¶

åˆå§‹åŒ–åä¼šåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `config.json` | é…ç½®æ–‡ä»¶ |
| `AGENTS.md` | Agent æŒ‡ä»¤/è¡Œä¸ºè§„èŒƒ |
| `SOUL.md` | äººæ ¼è®¾å®š |
| `USER.md` | ç”¨æˆ·ä¿¡æ¯ |
| `HEARTBEAT.md` | å®šæ—¶ä»»åŠ¡æ¸…å• |
| `memory/MEMORY.md` | é•¿æœŸè®°å¿† |

---

## 9. ä½¿ç”¨åœºæ™¯

### 9.1 å‘½ä»¤è¡Œäº¤äº’

```bash
# å•æ¬¡å¯¹è¯
nanobot agent -m "ä½ å¥½"

# äº¤äº’æ¨¡å¼
nanobot agent
```

### 9.2 é£ä¹¦é›†æˆ

```bash
# å¯åŠ¨ç½‘å…³æœåŠ¡
nanobot gateway
```

### 9.3 å®šæ—¶ä»»åŠ¡

```bash
# æ·»åŠ å®šæ—¶ä»»åŠ¡
nanobot cron add --name "daily" --message "æ—©ä¸Šå¥½!" --cron "0 9 * * *"

# æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
nanobot cron list
```

---

## 10. æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ |
|------|------|
| è¿è¡Œæ—¶ | Bun |
| è¯­è¨€ | TypeScript |
| LLM SDK | Anthropic SDK, OpenAI SDK |
| æ¶ˆæ¯é€šé“ | é£ä¹¦ API |
| å®šæ—¶ä»»åŠ¡ | cron-parser |

---

## 11. æ€»ç»“

nanobot æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾å·§çš„ AI Agent æ¡†æ¶ï¼Œå®ƒçš„æ ¸å¿ƒè®¾è®¡å“²å­¦æ˜¯ï¼š

1. **æç®€ä¸»ä¹‰**ï¼šç”¨æœ€å°‘çš„ä»£ç å®ç°æ ¸å¿ƒåŠŸèƒ½
2. **æ¨¡å—åŒ–**ï¼šå„ç»„ä»¶èŒè´£æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
3. **å¤šé€šé“**ï¼šæ”¯æŒå¤šç§äº¤äº’æ–¹å¼
4. **å¯è‡ªåŠ¨åŒ–**ï¼šæ”¯æŒå®šæ—¶ä»»åŠ¡å’Œå¿ƒè·³æœåŠ¡

é€šè¿‡æœ¬æ–‡æ¡£ï¼Œæ‚¨åº”è¯¥å¯¹ nanobot æœ‰äº†å…¨é¢çš„ç†è§£ï¼ŒåŒ…æ‹¬ï¼š
- ç³»ç»Ÿæ•´ä½“æ¶æ„
- æ ¸å¿ƒæ¨¡å—çš„èŒè´£å’Œäº¤äº’æ–¹å¼
- æ•°æ®å¦‚ä½•åœ¨ç³»ç»Ÿä¸­æµè½¬
- å¦‚ä½•é…ç½®å’Œä½¿ç”¨ç³»ç»Ÿ

å¦‚æœæ‚¨æƒ³æ·±å…¥äº†è§£æŸä¸ªæ¨¡å—ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æºä»£ç æ–‡ä»¶ã€‚
